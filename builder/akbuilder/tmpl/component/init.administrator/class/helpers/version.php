<?php
/**
 * @package     Windwalker.Framework
 * @subpackage  AKComponentHelper
 *
 * @copyright   Copyright (C) 2012 Asikart. All rights reserved.
 * @license     GNU General Public License version 2 or later; see LICENSE.txt
 * @author      Generated by AKHelper - http://asikart.com
 */

 
// no direct access
defined('_JEXEC') or die;


class AKComponentHelperVersion
{
	
	protected static $version ;
	
	protected static $plugins ;
	
	/*
	 * function get
	 * @param 
	 */
	
	public static function get($version)
	{
		if(!empty(self::$version[$version])){
			return true ;
		}
		
		return false ;
	}
	
	/*
	 * function detectVersion
	 * @param 
	 */
	
	public static function detectVersion()
	{
		jimport('joomla.filesystem.folder');
		$versions = JFolder::folders(AKComponentHelper::_('path.getAdmin').'/includes/version');
		
		if(!$versions){
			$versions = array();
		}
		
		foreach( $versions as $version ):
			self::attachPlugin($version);
		endforeach;
	}
	
	/*
	 * function attachProPlugin
	 * @param 
	 */
	
	public static function attachPlugin($version)
	{
		$app 	= JFactory::getApplication() ;
		$path 	= AKComponentHelper::_('path.getAdmin') . "/class/version/{$version}/{$version}.php" ;
		$option = JRequest::getVar('option') ;
		$config['params'] = JComponentHelper::getParams($option) ;
		
		if(JFile::exists($path)){
			include_once $path ;
			$dispatcher = JDispatcher::getInstance();
			
			$class_name = 'plg'.ucfirst(str_replace('com_', '', $option)).ucfirst($version) ;
			
			if(class_exists($class_name)){
			
				$plugin = new $class_name($dispatcher, $config);
				$dispatcher->attach($plugin);
				
				self::$plugins[$version] = $plugin;
				self::$version[$version] = true ;
				
				return true ;
			}else{
				return false ;
			}
			
		}else{
			return false ;
		}
		
	}
	
}
